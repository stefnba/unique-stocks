##
# Base compose file
##
version: '3.8'

services:
    app:
        container_name: unique-stocks-log
        environment:
            MONGO_HOST: mongodb # necessary to change since communication through container networks
        depends_on:
            - mongodb
        restart: always
        networks:
            - unique-stocks-network
            - default

    mongodb:
        image: mongo:latest
        container_name: unique-stocks-log-mongodb
        restart: always
        environment:
            MONGO_INITDB_ROOT_USERNAME: ${MONGO_USER}
            MONGO_INITDB_ROOT_PASSWORD: ${MONGO_PASSWORD}
        ports:
            - ${MONGO_PORT}:${MONGO_PORT}
        volumes:
            - mongodb_data:/data/db
        networks:
            - unique-stocks-network
            - default

    mongo-express:
        image: mongo-express
        ports:
            - 8099:8081
        depends_on:
            - mongodb
        restart: always
        environment:
            ME_CONFIG_BASICAUTH_USERNAME: ${MONGO_USER}
            ME_CONFIG_BASICAUTH_PASSWORD: ${MONGO_PASSWORD}
            ME_CONFIG_MONGODB_ADMINUSERNAME: ${MONGO_USER}
            ME_CONFIG_MONGODB_ADMINPASSWORD: ${MONGO_PASSWORD}
            ME_CONFIG_MONGODB_URL: mongodb://${MONGO_USER}:${MONGO_PASSWORD}@mongodb:${MONGO_PORT}
        links:
            - mongodb

volumes:
    mongodb_data:

networks:
    unique-stocks-network:
        name: unique-stocks-network
        external: true
